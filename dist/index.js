"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("zod");class e extends Error{constructor(t,e,r){super(t),this.code=e,this.details=r,this.name="PageVisualizerError"}}class r extends e{constructor(t,e){super(t,"VALIDATION_ERROR",e),this.name="ValidationError"}}class o extends e{constructor(t,e){super(t,"RENDERING_ERROR",e),this.name="RenderingError"}}const i=t.z.union([t.z.number().positive(),t.z.string().regex(/^\d+(\.\d+)?(px|%|vw|vh|em|rem)$/)]),n=t.z.object({x:i,y:i,width:i,height:i,alignment:t.z.enum(["left","center","right","justify"]).optional()}),s=t.z.object({color:t.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/).optional(),image:t.z.string().url().optional(),gradient:t.z.string().optional()}),a=t.z.object({fontSize:t.z.union([t.z.number().positive(),t.z.string()]),fontFamily:t.z.string().min(1),fontStyle:t.z.enum(["normal","italic","oblique"]).optional(),fontWeight:t.z.union([t.z.number().min(100).max(900),t.z.enum(["normal","bold"])]).optional(),color:t.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),lineHeight:t.z.number().positive().optional(),letterSpacing:t.z.number().optional(),textDecoration:t.z.enum(["none","underline","line-through"]).optional(),shadow:t.z.string().optional(),opacity:t.z.number().min(0).max(1).optional()}),c=t.z.object({width:t.z.number().nonnegative(),style:t.z.enum(["solid","dashed","dotted"]),color:t.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),radius:t.z.number().nonnegative().optional()}),l=t.z.object({id:t.z.string().optional(),content:t.z.string(),position:n,formatting:a,zIndex:t.z.number().int().optional()}),h=t.z.object({id:t.z.string().optional(),src:t.z.string().url(),position:n,zIndex:t.z.number().int().optional(),altText:t.z.string().optional(),filters:t.z.array(t.z.string()).optional(),border:c.optional()}),d=t.z.object({type:t.z.enum(["absolute","grid","flex"]),columns:t.z.number().int().positive().optional(),rows:t.z.number().int().positive().optional(),direction:t.z.enum(["row","column"]).optional(),responsive:t.z.boolean().optional()}),g=t.z.object({target:t.z.string().min(1),type:t.z.enum(["fadeIn","slide","rotate"]),duration:t.z.number().positive(),delay:t.z.number().nonnegative().optional()}),p=t.z.object({id:t.z.string().min(1),type:t.z.enum(["button","link","input","custom"]),position:n,content:t.z.string().optional(),zIndex:t.z.number().int().optional(),onClick:t.z.function().optional(),onHover:t.z.function().optional(),onFocus:t.z.function().optional(),onBlur:t.z.function().optional()}),u=t.z.object({name:t.z.string().min(1),colors:t.z.object({primary:t.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),secondary:t.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),background:t.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),text:t.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),accent:t.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/)}),fonts:t.z.object({primary:t.z.string().min(1),secondary:t.z.string().min(1),heading:t.z.string().min(1)}),spacing:t.z.object({small:t.z.number().positive(),medium:t.z.number().positive(),large:t.z.number().positive()})}),m=t.z.object({pageWidth:t.z.number().positive(),pageHeight:t.z.number().positive(),margin:t.z.object({top:t.z.number().nonnegative(),right:t.z.number().nonnegative(),bottom:t.z.number().nonnegative(),left:t.z.number().nonnegative()}),theme:t.z.union([t.z.enum(["light","dark"]),u])}),w=t.z.object({id:t.z.union([t.z.string(),t.z.number()]),background:s.optional(),textBlocks:t.z.array(l).optional(),images:t.z.array(h).optional(),layout:d.optional(),animations:t.z.array(g).optional(),interactiveElements:t.z.array(p).optional()}),f=t.z.object({container:t.z.instanceof(HTMLElement),mode:t.z.enum(["canvas","svg","dom"]).optional(),globalStyles:m.partial().optional(),onError:t.z.function().optional(),onLoad:t.z.function().optional(),onRender:t.z.function().optional()}),x=t.z.object({format:t.z.enum(["png","jpeg","pdf","svg"]),quality:t.z.number().min(0).max(1).optional(),filename:t.z.string().optional()}),b=e=>{try{return w.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid page data: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},z=e=>{try{return f.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid PageVisualizer options: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},y=e=>{try{return x.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid export options: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},v=(t,e)=>{if("number"==typeof t)return t;const r=t.match(/^(\d+(?:\.\d+)?)(px|%|vw|vh|em|rem)$/);if(!r)throw new Error(`Invalid position value: ${t}`);const[,o,i]=r,n=parseFloat(o);switch(i){case"px":default:return n;case"%":return n/100*e;case"vw":return n/100*window.innerWidth;case"vh":return n/100*window.innerHeight;case"em":case"rem":return 16*n}},S=t=>{const e=document.createElement("div");return e.textContent=t,e.innerHTML},A=t=>new Promise((e,r)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>e(o),o.onerror=()=>r(new Error(`Failed to load image: ${t}`)),o.src=t}),E=(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r.style.display="block",r},I=(t,e)=>{const r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("width",t.toString()),r.setAttribute("height",e.toString()),r.setAttribute("viewBox",`0 0 ${t} ${e}`),r},R=(t,e)=>{const r="number"==typeof e.fontSize?e.fontSize:v(e.fontSize,16);if(t.font=`${e.fontStyle||"normal"} ${e.fontWeight||"normal"} ${r}px ${e.fontFamily}`,t.fillStyle=e.color,t.globalAlpha=e.opacity??1,e.shadow){const r=e.shadow.split(" ");r.length>=3&&(t.shadowColor=r[2],t.shadowOffsetX=parseFloat(r[0])||0,t.shadowOffsetY=parseFloat(r[1])||0,t.shadowBlur=parseFloat(r[3])||0)}e.letterSpacing},P=(t,e,r,o,i,n="left")=>{if(t.textAlign=n,t.textBaseline="top","justify"===n){const n=e.split(" ");if(n.length>1){const s=t.measureText(" ").width,a=(i-t.measureText(e).width)/(n.length-1);let c=r;for(let e=0;e<n.length;e++)t.fillText(n[e],c,o),c+=t.measureText(n[e]).width+s+a}else t.fillText(e,r,o)}else t.fillText(e,r,o)},T=(t,e,r,o,i,n)=>{t.strokeStyle=n.color,t.lineWidth=n.width,t.setLineDash("dashed"===n.style?[5,5]:"dotted"===n.style?[2,2]:[]),n.radius?(t.beginPath(),t.roundRect(e,r,o,i,n.radius),t.stroke()):t.strokeRect(e,r,o,i)},C=(t,e)=>{if(0===e.length)return;const r=e.join(" ");t.filter=r},k=(t,e,r)=>{if(!r)return{width:t.measureText(e).width,height:parseFloat(t.font)||16,lines:[e]};const o=e.split(" "),i=[];let n="";for(const e of o){const o=n+(n?" ":"")+e;t.measureText(o).width>r&&n?(i.push(n),n=e):n=o}n&&i.push(n);const s=parseFloat(t.font)||16,a=i.length*s;return{width:Math.max(...i.map(e=>t.measureText(e).width)),height:a,lines:i}},$=(t,e)=>{let r;return(...o)=>{clearTimeout(r),r=setTimeout(()=>t(...o),e)}},D=t=>{if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array)return t.map(t=>D(t));if("object"==typeof t){const e={};for(const r in t)t.hasOwnProperty(r)&&(e[r]=D(t[r]));return e}return t};class F{constructor(t){this.loadedImages=new Map,this.context=t}async renderPage(t){if(!this.context.canvas||!this.context.ctx)throw new Error("Canvas context not available");const{ctx:e,width:r,height:o}=this.context;e.clearRect(0,0,r,o);try{if(t.background&&await this.renderBackground(t.background,r,o),t.images){const e=[...t.images].sort((t,e)=>(t.zIndex||0)-(e.zIndex||0));for(const t of e)await this.renderImage(t,r,o)}if(t.textBlocks){const e=[...t.textBlocks].sort((t,e)=>(t.zIndex||0)-(e.zIndex||0));for(const t of e)this.renderTextBlock(t,r,o)}t.animations&&this.applyAnimations(t.animations)}catch(t){throw console.error("Error rendering page:",t),t}}async renderBackground(t,e,r){if(!this.context.ctx)return;const{ctx:o}=this.context;if(t.color&&(o.fillStyle=t.color,o.fillRect(0,0,e,r)),t.gradient){const i=t.gradient.match(/linear-gradient\((\d+)deg,\s*([^,]+),\s*([^)]+)\)/);if(i){const[,t,n,s]=i,a=parseFloat(t)*Math.PI/180,c=o.createLinearGradient(Math.cos(a)*e,Math.sin(a)*r,Math.cos(a+Math.PI)*e,Math.sin(a+Math.PI)*r);c.addColorStop(0,n.trim()),c.addColorStop(1,s.trim()),o.fillStyle=c,o.fillRect(0,0,e,r)}}if(t.image)try{const i=await this.loadImage(t.image);o.drawImage(i,0,0,e,r)}catch(t){console.warn("Failed to load background image:",t)}}renderTextBlock(t,e,r){if(!this.context.ctx)return;const{ctx:o}=this.context,{x:i,y:n,width:s,height:a}=this.parsePosition(t.position,e,r);R(o,t.formatting);const c=t.position.alignment||"left";let l=i;"center"===c?l=i+s/2:"right"===c&&(l=i+s);const h=k(o,t.content,s),d=v(t.formatting.lineHeight||t.formatting.fontSize,16);let g=n;for(const t of h.lines)P(o,t,l,g,s,c),g+=d;"underline"===t.formatting.textDecoration&&(o.beginPath(),o.moveTo(i,g-2),o.lineTo(i+s,g-2),o.stroke())}async renderImage(t,e,r){if(!this.context.ctx)return;const{ctx:o}=this.context,{x:i,y:n,width:s,height:a}=this.parsePosition(t.position,e,r);try{const e=await this.loadImage(t.src);t.filters&&t.filters.length>0&&C(o,t.filters),o.drawImage(e,i,n,s,a),t.border&&T(o,i,n,s,a,t.border)}catch(e){console.warn("Failed to load image:",t.src,e),o.fillStyle="#f0f0f0",o.fillRect(i,n,s,a),o.fillStyle="#666",o.font="14px Arial",o.textAlign="center",o.fillText("Image not found",i+s/2,n+a/2)}}applyAnimations(t){for(const e of t){const t=document.getElementById(e.target);t&&(t.style.transition=`all ${e.duration}ms ease`,t.style.opacity="0",setTimeout(()=>{t.style.opacity="1"},e.delay||0))}}async loadImage(t){if(this.loadedImages.has(t))return this.loadedImages.get(t);const e=await A(t);return this.loadedImages.set(t,e),e}parsePosition(t,e,r){return{x:v(t.x,e),y:v(t.y,r),width:v(t.width,e),height:v(t.height,r)}}resize(t,e){this.context.canvas&&(this.context.canvas.width=t,this.context.canvas.height=e,this.context.width=t,this.context.height=e)}clear(){if(!this.context.ctx)return;const{ctx:t,width:e,height:r}=this.context;t.clearRect(0,0,e,r)}getDataURL(t="image/png",e){if(!this.context.canvas)throw new Error("Canvas not available");return"image/jpeg"===t&&e?this.context.canvas.toDataURL(t,e):this.context.canvas.toDataURL(t)}destroy(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.loadedImages.clear()}}class j{constructor(t){this.loadedImages=new Map,this.context=t}async renderPage(t){if(!this.context.svg)throw new Error("SVG context not available");const{svg:e,width:r,height:o}=this.context;e.innerHTML="";try{if(t.background&&await this.renderBackground(t.background,r,o),t.images){const e=[...t.images].sort((t,e)=>(t.zIndex||0)-(e.zIndex||0));for(const t of e)await this.renderImage(t,r,o)}if(t.textBlocks){const e=[...t.textBlocks].sort((t,e)=>(t.zIndex||0)-(e.zIndex||0));for(const t of e)this.renderTextBlock(t,r,o)}t.animations&&this.applyAnimations(t.animations)}catch(t){throw console.error("Error rendering page:",t),t}}async renderBackground(t,e,r){if(!this.context.svg)return;const{svg:o}=this.context;if(t.color){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width",e.toString()),i.setAttribute("height",r.toString()),i.setAttribute("fill",t.color),o.appendChild(i)}if(t.gradient){const i=`gradient-${Math.random().toString(36).substr(2,9)}`,n=t.gradient.match(/linear-gradient\((\d+)deg,\s*([^,]+),\s*([^)]+)\)/);if(n){const[,t,s,a]=n,c=document.createElementNS("http://www.w3.org/2000/svg","defs"),l=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");l.setAttribute("id",i),l.setAttribute("x1","0%"),l.setAttribute("y1","0%"),l.setAttribute("x2","100%"),l.setAttribute("y2","100%"),l.setAttribute("gradientTransform",`rotate(${t})`);const h=document.createElementNS("http://www.w3.org/2000/svg","stop");h.setAttribute("offset","0%"),h.setAttribute("stop-color",s.trim());const d=document.createElementNS("http://www.w3.org/2000/svg","stop");d.setAttribute("offset","100%"),d.setAttribute("stop-color",a.trim()),l.appendChild(h),l.appendChild(d),c.appendChild(l),o.appendChild(c);const g=document.createElementNS("http://www.w3.org/2000/svg","rect");g.setAttribute("x","0"),g.setAttribute("y","0"),g.setAttribute("width",e.toString()),g.setAttribute("height",r.toString()),g.setAttribute("fill",`url(#${i})`),o.appendChild(g)}}if(t.image)try{const i=await this.loadImageAsDataURL(t.image),n=document.createElementNS("http://www.w3.org/2000/svg","image");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width",e.toString()),n.setAttribute("height",r.toString()),n.setAttribute("href",i),n.setAttribute("preserveAspectRatio","xMidYMid slice"),o.appendChild(n)}catch(t){console.warn("Failed to load background image:",t)}}renderTextBlock(t,e,r){if(!this.context.svg)return;const{svg:o}=this.context,{x:i,y:n,width:s,height:a}=this.parsePosition(t.position,e,r),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",i.toString()),c.setAttribute("y",(n+v(t.formatting.fontSize,16)).toString()),c.setAttribute("width",s.toString()),c.setAttribute("height",a.toString()),this.applyTextFormatting(c,t.formatting);const l=t.position.alignment||"left";"center"===l?(c.setAttribute("text-anchor","middle"),c.setAttribute("x",(i+s/2).toString())):"right"===l&&(c.setAttribute("text-anchor","end"),c.setAttribute("x",(i+s).toString()));const h=this.wrapText(t.content,t.formatting,s);if(1===h.length)c.textContent=S(h[0]),o.appendChild(c);else{const e=v(t.formatting.lineHeight||t.formatting.fontSize,16);for(let t=0;t<h.length;t++){const r=document.createElementNS("http://www.w3.org/2000/svg","tspan");r.setAttribute("x",c.getAttribute("x")||"0"),r.setAttribute("dy",0===t?"0":e.toString()),r.textContent=S(h[t]),c.appendChild(r)}o.appendChild(c)}if("underline"===t.formatting.textDecoration){const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1",i.toString()),e.setAttribute("y1",(n+a-2).toString()),e.setAttribute("x2",(i+s).toString()),e.setAttribute("y2",(n+a-2).toString()),e.setAttribute("stroke",t.formatting.color),e.setAttribute("stroke-width","1"),o.appendChild(e)}}async renderImage(t,e,r){if(!this.context.svg)return;const{svg:o}=this.context,{x:i,y:n,width:s,height:a}=this.parsePosition(t.position,e,r);try{const e=await this.loadImageAsDataURL(t.src),r=document.createElementNS("http://www.w3.org/2000/svg","image");if(r.setAttribute("x",i.toString()),r.setAttribute("y",n.toString()),r.setAttribute("width",s.toString()),r.setAttribute("height",a.toString()),r.setAttribute("href",e),r.setAttribute("preserveAspectRatio","xMidYMid meet"),t.altText&&r.setAttribute("alt",t.altText),t.filters&&t.filters.length>0){const e=`filter-${Math.random().toString(36).substr(2,9)}`;this.createFilter(e,t.filters),r.setAttribute("filter",`url(#${e})`)}o.appendChild(r),t.border&&this.drawBorder(i,n,s,a,t.border)}catch(e){console.warn("Failed to load image:",t.src,e);const r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x",i.toString()),r.setAttribute("y",n.toString()),r.setAttribute("width",s.toString()),r.setAttribute("height",a.toString()),r.setAttribute("fill","#f0f0f0"),r.setAttribute("stroke","#ccc"),r.setAttribute("stroke-width","1"),o.appendChild(r);const c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",(i+s/2).toString()),c.setAttribute("y",(n+a/2).toString()),c.setAttribute("text-anchor","middle"),c.setAttribute("fill","#666"),c.setAttribute("font-family","Arial"),c.setAttribute("font-size","14"),c.textContent="Image not found",o.appendChild(c)}}applyAnimations(t){for(const e of t){const t=document.getElementById(e.target);t&&(t.style.transition=`all ${e.duration}ms ease`,t.style.opacity="0",setTimeout(()=>{t.style.opacity="1"},e.delay||0))}}async loadImageAsDataURL(t){if(this.loadedImages.has(t))return this.loadedImages.get(t);const e=await A(t),r=document.createElement("canvas"),o=r.getContext("2d");r.width=e.width,r.height=e.height,o.drawImage(e,0,0);const i=r.toDataURL("image/png");return this.loadedImages.set(t,i),i}parsePosition(t,e,r){return{x:v(t.x,e),y:v(t.y,r),width:v(t.width,e),height:v(t.height,r)}}applyTextFormatting(t,e){const r="number"==typeof e.fontSize?e.fontSize:v(e.fontSize,16);if(t.setAttribute("font-family",e.fontFamily),t.setAttribute("font-size",r.toString()),t.setAttribute("fill",e.color),e.fontStyle&&t.setAttribute("font-style",e.fontStyle),e.fontWeight&&t.setAttribute("font-weight",e.fontWeight.toString()),e.letterSpacing&&t.setAttribute("letter-spacing",e.letterSpacing.toString()),e.opacity&&t.setAttribute("opacity",e.opacity.toString()),e.shadow){const r=e.shadow.split(" ");if(r.length>=3){const e=`shadow-${Math.random().toString(36).substr(2,9)}`;this.createShadowFilter(e,r),t.setAttribute("filter",`url(#${e})`)}}}wrapText(t,e,r){const o=t.split(" "),i=[];let n="";for(const t of o){const o=n+(n?" ":"")+t,s="number"==typeof e.fontSize?e.fontSize:v(e.fontSize,16);o.length*s*.6>r&&n?(i.push(n),n=t):n=o}return n&&i.push(n),i}createFilter(t,e){if(!this.context.svg)return;let r=this.context.svg.querySelector("defs");r||(r=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.context.svg.appendChild(r));const o=document.createElementNS("http://www.w3.org/2000/svg","filter");o.setAttribute("id",t);for(const t of e)if(t.includes("blur")){const e=t.match(/blur\((\d+)px\)/);if(e){const t=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");t.setAttribute("stdDeviation",e[1]),o.appendChild(t)}}r.appendChild(o)}createShadowFilter(t,e){if(!this.context.svg)return;let r=this.context.svg.querySelector("defs");r||(r=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.context.svg.appendChild(r));const o=document.createElementNS("http://www.w3.org/2000/svg","filter");o.setAttribute("id",t);const i=document.createElementNS("http://www.w3.org/2000/svg","feDropShadow");i.setAttribute("dx",e[0]||"0"),i.setAttribute("dy",e[1]||"0"),i.setAttribute("stdDeviation",e[3]||"0"),i.setAttribute("flood-color",e[2]||"#000"),o.appendChild(i),r.appendChild(o)}drawBorder(t,e,r,o,i){if(!this.context.svg)return;const{svg:n}=this.context,s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("x",t.toString()),s.setAttribute("y",e.toString()),s.setAttribute("width",r.toString()),s.setAttribute("height",o.toString()),s.setAttribute("fill","none"),s.setAttribute("stroke",i.color),s.setAttribute("stroke-width",i.width.toString()),"dashed"===i.style?s.setAttribute("stroke-dasharray","5,5"):"dotted"===i.style&&s.setAttribute("stroke-dasharray","2,2"),i.radius&&(s.setAttribute("rx",i.radius.toString()),s.setAttribute("ry",i.radius.toString())),n.appendChild(s)}resize(t,e){this.context.svg&&(this.context.svg.setAttribute("width",t.toString()),this.context.svg.setAttribute("height",e.toString()),this.context.svg.setAttribute("viewBox",`0 0 ${t} ${e}`),this.context.width=t,this.context.height=e)}getDataURL(){if(!this.context.svg)throw new Error("SVG not available");const t=(new XMLSerializer).serializeToString(this.context.svg);return`data:image/svg+xml,${encodeURIComponent(t)}`}clear(){this.context.svg&&(this.context.svg.innerHTML="")}destroy(){this.loadedImages.clear()}}var O=PageVisualizer;exports.AssetLoadError=class extends e{constructor(t,e){super(t,"ASSET_LOAD_ERROR",e),this.name="AssetLoadError"}},exports.CanvasRenderer=F,exports.PageVisualizer=class{constructor(t){this.currentPage=null,this.isDestroyed=!1,this.options=z(t);const e={pageWidth:800,pageHeight:600,margin:{top:20,right:20,bottom:20,left:20},theme:"light",...this.options.globalStyles};this.context=this.createRenderingContext(e),this.renderer=this.createRenderer(),this.setupResizeHandling(),this.initializeContainer()}async renderPage(t){if(this.isDestroyed)throw new e("PageVisualizer has been destroyed","DESTROYED");try{const e=b(t);this.currentPage=e,this.updateContextForPage(e),await this.renderer.renderPage(e),this.options.onRender?.()}catch(t){const e=new o(`Failed to render page: ${t instanceof Error?t.message:"Unknown error"}`,t);throw this.options.onError?.(e),e}}async exportPage(t){if(this.isDestroyed)throw new e("PageVisualizer has been destroyed","DESTROYED");if(!this.currentPage)throw new e("No page to export","NO_PAGE");try{const r=y(t);if("canvas"===this.options.mode&&this.renderer instanceof F)return this.renderer.getDataURL(r.format,r.quality);if("svg"===this.options.mode&&this.renderer instanceof j)return this.renderer.getDataURL();throw new e("Export not supported for current rendering mode","UNSUPPORTED_EXPORT")}catch(t){const r=new e(`Failed to export page: ${t instanceof Error?t.message:"Unknown error"}`,"EXPORT_ERROR",t);throw this.options.onError?.(r),r}}resize(t,r){if(this.isDestroyed)throw new e("PageVisualizer has been destroyed","DESTROYED");this.context.width=t,this.context.height=r,this.context.scale=Math.min(t/this.options.globalStyles.pageWidth,r/this.options.globalStyles.pageHeight),this.renderer.resize(t,r),this.currentPage&&this.renderPage(this.currentPage).catch(t=>{this.options.onError?.(t)})}clear(){this.isDestroyed||(this.renderer.clear(),this.currentPage=null)}getCurrentPage(){return this.currentPage}getContext(){return{...this.context}}updateGlobalStyles(t){this.isDestroyed||(this.options.globalStyles={...this.options.globalStyles,...t},this.context.width=this.options.globalStyles.pageWidth,this.context.height=this.options.globalStyles.pageHeight,this.currentPage&&this.renderPage(this.currentPage).catch(t=>{this.options.onError?.(t)}))}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.renderer.destroy(),this.resizeObserver&&this.resizeObserver.disconnect(),this.options.container&&(this.options.container.innerHTML=""),this.currentPage=null,this.context=null,this.renderer=null)}createRenderingContext(t){const{pageWidth:r,pageHeight:o}=t,i={width:r,height:o,scale:1};switch(this.options.mode){case"canvas":const t=E(r,o),n=t.getContext("2d");if(!n)throw new e("Failed to get 2D context from canvas","CANVAS_ERROR");i.canvas=t,i.ctx=n;break;case"svg":const s=I(r,o);i.svg=s;break;case"dom":i.container=this.options.container;break;default:throw new e(`Unsupported rendering mode: ${this.options.mode}`,"UNSUPPORTED_MODE")}return i}createRenderer(){switch(this.options.mode){case"canvas":return new F(this.context);case"svg":return new j(this.context);case"dom":throw new e("DOM renderer not yet implemented","NOT_IMPLEMENTED");default:throw new e(`Unsupported rendering mode: ${this.options.mode}`,"UNSUPPORTED_MODE")}}initializeContainer(){const{container:t}=this.options;t.innerHTML="",this.context.canvas?t.appendChild(this.context.canvas):this.context.svg&&t.appendChild(this.context.svg),t.style.position="relative",t.style.overflow="hidden",this.options.onLoad?.()}updateContextForPage(t){}setupResizeHandling(){if("undefined"!=typeof ResizeObserver)this.resizeObserver=new ResizeObserver($(t=>{for(const e of t){const{width:t,height:r}=e.contentRect;this.resize(t,r)}},100)),this.resizeObserver.observe(this.options.container);else{const t=$(()=>{const t=this.options.container.getBoundingClientRect();this.resize(t.width,t.height)},100);window.addEventListener("resize",t)}}},exports.PageVisualizerError=e,exports.RenderingError=o,exports.SVGRenderer=j,exports.ValidationError=r,exports.animationSchema=g,exports.applyImageFilters=C,exports.applyTextFormatting=R,exports.backgroundSchema=s,exports.createCanvas=E,exports.createSVG=I,exports.customThemeSchema=u,exports.debounce=$,exports.deepClone=D,exports.default=O,exports.drawBorder=T,exports.drawText=P,exports.exportOptionsSchema=x,exports.generateId=()=>Math.random().toString(36).substr(2,9),exports.getTextMetrics=k,exports.globalStylesSchema=m,exports.imageElementSchema=h,exports.interactiveElementSchema=p,exports.isInViewport=t=>{const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},exports.layoutOptionsSchema=d,exports.loadImage=A,exports.pageSchema=w,exports.pageVisualizerOptionsSchema=f,exports.parsePositionValue=v,exports.positionSchema=n,exports.positionToAbsolute=(t,e,r)=>({x:v(t.x,e),y:v(t.y,r),width:v(t.width,e),height:v(t.height,r)}),exports.sanitizeHtml=S,exports.textBlockSchema=l,exports.throttle=(t,e)=>{let r;return(...o)=>{r||(t(...o),r=!0,setTimeout(()=>r=!1,e))}},exports.validateAnimation=e=>{try{return g.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid animation data: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},exports.validateBackground=e=>{try{return s.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid background data: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},exports.validateCustomTheme=e=>{try{return u.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid custom theme: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},exports.validateExportOptions=y,exports.validateGlobalStyles=e=>{try{return m.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid global styles: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},exports.validateImageElement=e=>{try{return h.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid image element data: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},exports.validateInteractiveElement=e=>{try{return p.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid interactive element data: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},exports.validateLayoutOptions=e=>{try{return d.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid layout options: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},exports.validatePage=b,exports.validatePageVisualizerOptions=z,exports.validatePosition=e=>{try{return n.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid position data: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}},exports.validateTextBlock=e=>{try{return l.parse(e)}catch(e){if(e instanceof t.z.ZodError)throw new r(`Invalid text block data: ${e.errors.map(t=>t.message).join(", ")}`,e.errors);throw e}};
//# sourceMappingURL=index.js.map
