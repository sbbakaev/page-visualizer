!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("zod")):"function"==typeof define&&define.amd?define(["exports","zod"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).PageVisualizer={},t.z)}(this,function(t,e){"use strict";class r extends Error{constructor(t,e,r){super(t),this.code=e,this.details=r,this.name="PageVisualizerError"}}class i extends r{constructor(t,e){super(t,"VALIDATION_ERROR",e),this.name="ValidationError"}}class n extends r{constructor(t,e){super(t,"RENDERING_ERROR",e),this.name="RenderingError"}}const o=e.z.union([e.z.number().positive(),e.z.string().regex(/^\d+(\.\d+)?(px|%|vw|vh|em|rem)$/)]),s=e.z.object({x:o,y:o,width:o,height:o,alignment:e.z.enum(["left","center","right","justify"]).optional()}),a=e.z.object({color:e.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/).optional(),image:e.z.string().url().optional(),gradient:e.z.string().optional()}),c=e.z.object({fontSize:e.z.union([e.z.number().positive(),e.z.string()]),fontFamily:e.z.string().min(1),fontStyle:e.z.enum(["normal","italic","oblique"]).optional(),fontWeight:e.z.union([e.z.number().min(100).max(900),e.z.enum(["normal","bold"])]).optional(),color:e.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),lineHeight:e.z.number().positive().optional(),letterSpacing:e.z.number().optional(),textDecoration:e.z.enum(["none","underline","line-through"]).optional(),shadow:e.z.string().optional(),opacity:e.z.number().min(0).max(1).optional()}),l=e.z.object({width:e.z.number().nonnegative(),style:e.z.enum(["solid","dashed","dotted"]),color:e.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),radius:e.z.number().nonnegative().optional()}),h=e.z.object({id:e.z.string().optional(),content:e.z.string(),position:s,formatting:c,zIndex:e.z.number().int().optional()}),d=e.z.object({id:e.z.string().optional(),src:e.z.string().url(),position:s,zIndex:e.z.number().int().optional(),altText:e.z.string().optional(),filters:e.z.array(e.z.string()).optional(),border:l.optional()}),g=e.z.object({type:e.z.enum(["absolute","grid","flex"]),columns:e.z.number().int().positive().optional(),rows:e.z.number().int().positive().optional(),direction:e.z.enum(["row","column"]).optional(),responsive:e.z.boolean().optional()}),u=e.z.object({target:e.z.string().min(1),type:e.z.enum(["fadeIn","slide","rotate"]),duration:e.z.number().positive(),delay:e.z.number().nonnegative().optional()}),p=e.z.object({id:e.z.string().min(1),type:e.z.enum(["button","link","input","custom"]),position:s,content:e.z.string().optional(),zIndex:e.z.number().int().optional(),onClick:e.z.function().optional(),onHover:e.z.function().optional(),onFocus:e.z.function().optional(),onBlur:e.z.function().optional()}),m=e.z.object({name:e.z.string().min(1),colors:e.z.object({primary:e.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),secondary:e.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),background:e.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),text:e.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/),accent:e.z.string().regex(/^#[0-9A-Fa-f]{6}$|^rgb\(|^rgba\(|^hsl\(|^hsla\(/)}),fonts:e.z.object({primary:e.z.string().min(1),secondary:e.z.string().min(1),heading:e.z.string().min(1)}),spacing:e.z.object({small:e.z.number().positive(),medium:e.z.number().positive(),large:e.z.number().positive()})}),f=e.z.object({pageWidth:e.z.number().positive(),pageHeight:e.z.number().positive(),margin:e.z.object({top:e.z.number().nonnegative(),right:e.z.number().nonnegative(),bottom:e.z.number().nonnegative(),left:e.z.number().nonnegative()}),theme:e.z.union([e.z.enum(["light","dark"]),m])}),w=e.z.object({id:e.z.union([e.z.string(),e.z.number()]),background:a.optional(),textBlocks:e.z.array(h).optional(),images:e.z.array(d).optional(),layout:g.optional(),animations:e.z.array(u).optional(),interactiveElements:e.z.array(p).optional()}),b=e.z.object({container:e.z.instanceof(HTMLElement),mode:e.z.enum(["canvas","svg","dom"]).optional(),globalStyles:f.partial().optional(),onError:e.z.function().optional(),onLoad:e.z.function().optional(),onRender:e.z.function().optional()}),x=e.z.object({format:e.z.enum(["png","jpeg","pdf","svg"]),quality:e.z.number().min(0).max(1).optional(),filename:e.z.string().optional()}),y=t=>{try{return w.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid page data: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},z=t=>{try{return b.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid PageVisualizer options: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},v=t=>{try{return x.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid export options: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},S=(t,e)=>{if("number"==typeof t)return t;const r=t.match(/^(\d+(?:\.\d+)?)(px|%|vw|vh|em|rem)$/);if(!r)throw new Error(`Invalid position value: ${t}`);const[,i,n]=r,o=parseFloat(i);switch(n){case"px":default:return o;case"%":return o/100*e;case"vw":return o/100*window.innerWidth;case"vh":return o/100*window.innerHeight;case"em":case"rem":return 16*o}},A=t=>{const e=document.createElement("div");return e.textContent=t,e.innerHTML},E=t=>new Promise((e,r)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>e(i),i.onerror=()=>r(new Error(`Failed to load image: ${t}`)),i.src=t}),I=(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r.style.display="block",r},R=(t,e)=>{const r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("width",t.toString()),r.setAttribute("height",e.toString()),r.setAttribute("viewBox",`0 0 ${t} ${e}`),r},T=(t,e)=>{const r="number"==typeof e.fontSize?e.fontSize:S(e.fontSize,16);if(t.font=`${e.fontStyle||"normal"} ${e.fontWeight||"normal"} ${r}px ${e.fontFamily}`,t.fillStyle=e.color,t.globalAlpha=e.opacity??1,e.shadow){const r=e.shadow.split(" ");r.length>=3&&(t.shadowColor=r[2],t.shadowOffsetX=parseFloat(r[0])||0,t.shadowOffsetY=parseFloat(r[1])||0,t.shadowBlur=parseFloat(r[3])||0)}e.letterSpacing},P=(t,e,r,i,n,o="left")=>{if(t.textAlign=o,t.textBaseline="top","justify"===o){const o=e.split(" ");if(o.length>1){const s=t.measureText(" ").width,a=(n-t.measureText(e).width)/(o.length-1);let c=r;for(let e=0;e<o.length;e++)t.fillText(o[e],c,i),c+=t.measureText(o[e]).width+s+a}else t.fillText(e,r,i)}else t.fillText(e,r,i)},C=(t,e,r,i,n,o)=>{t.strokeStyle=o.color,t.lineWidth=o.width,t.setLineDash("dashed"===o.style?[5,5]:"dotted"===o.style?[2,2]:[]),o.radius?(t.beginPath(),t.roundRect(e,r,i,n,o.radius),t.stroke()):t.strokeRect(e,r,i,n)},k=(t,e)=>{if(0===e.length)return;const r=e.join(" ");t.filter=r},$=(t,e,r)=>{if(!r)return{width:t.measureText(e).width,height:parseFloat(t.font)||16,lines:[e]};const i=e.split(" "),n=[];let o="";for(const e of i){const i=o+(o?" ":"")+e;t.measureText(i).width>r&&o?(n.push(o),o=e):o=i}o&&n.push(o);const s=parseFloat(t.font)||16,a=n.length*s;return{width:Math.max(...n.map(e=>t.measureText(e).width)),height:a,lines:n}},D=(t,e)=>{let r;return(...i)=>{clearTimeout(r),r=setTimeout(()=>t(...i),e)}},F=t=>{if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array)return t.map(t=>F(t));if("object"==typeof t){const e={};for(const r in t)t.hasOwnProperty(r)&&(e[r]=F(t[r]));return e}return t};class j{constructor(t){this.loadedImages=new Map,this.context=t}async renderPage(t){if(!this.context.canvas||!this.context.ctx)throw new Error("Canvas context not available");const{ctx:e,width:r,height:i}=this.context;e.clearRect(0,0,r,i);try{if(t.background&&await this.renderBackground(t.background,r,i),t.images){const e=[...t.images].sort((t,e)=>(t.zIndex||0)-(e.zIndex||0));for(const t of e)await this.renderImage(t,r,i)}if(t.textBlocks){const e=[...t.textBlocks].sort((t,e)=>(t.zIndex||0)-(e.zIndex||0));for(const t of e)this.renderTextBlock(t,r,i)}t.animations&&this.applyAnimations(t.animations)}catch(t){throw console.error("Error rendering page:",t),t}}async renderBackground(t,e,r){if(!this.context.ctx)return;const{ctx:i}=this.context;if(t.color&&(i.fillStyle=t.color,i.fillRect(0,0,e,r)),t.gradient){const n=t.gradient.match(/linear-gradient\((\d+)deg,\s*([^,]+),\s*([^)]+)\)/);if(n){const[,t,o,s]=n,a=parseFloat(t)*Math.PI/180,c=i.createLinearGradient(Math.cos(a)*e,Math.sin(a)*r,Math.cos(a+Math.PI)*e,Math.sin(a+Math.PI)*r);c.addColorStop(0,o.trim()),c.addColorStop(1,s.trim()),i.fillStyle=c,i.fillRect(0,0,e,r)}}if(t.image)try{const n=await this.loadImage(t.image);i.drawImage(n,0,0,e,r)}catch(t){console.warn("Failed to load background image:",t)}}renderTextBlock(t,e,r){if(!this.context.ctx)return;const{ctx:i}=this.context,{x:n,y:o,width:s,height:a}=this.parsePosition(t.position,e,r);T(i,t.formatting);const c=t.position.alignment||"left";let l=n;"center"===c?l=n+s/2:"right"===c&&(l=n+s);const h=$(i,t.content,s),d=S(t.formatting.lineHeight||t.formatting.fontSize,16);let g=o;for(const t of h.lines)P(i,t,l,g,s,c),g+=d;"underline"===t.formatting.textDecoration&&(i.beginPath(),i.moveTo(n,g-2),i.lineTo(n+s,g-2),i.stroke())}async renderImage(t,e,r){if(!this.context.ctx)return;const{ctx:i}=this.context,{x:n,y:o,width:s,height:a}=this.parsePosition(t.position,e,r);try{const e=await this.loadImage(t.src);t.filters&&t.filters.length>0&&k(i,t.filters),i.drawImage(e,n,o,s,a),t.border&&C(i,n,o,s,a,t.border)}catch(e){console.warn("Failed to load image:",t.src,e),i.fillStyle="#f0f0f0",i.fillRect(n,o,s,a),i.fillStyle="#666",i.font="14px Arial",i.textAlign="center",i.fillText("Image not found",n+s/2,o+a/2)}}applyAnimations(t){for(const e of t){const t=document.getElementById(e.target);t&&(t.style.transition=`all ${e.duration}ms ease`,t.style.opacity="0",setTimeout(()=>{t.style.opacity="1"},e.delay||0))}}async loadImage(t){if(this.loadedImages.has(t))return this.loadedImages.get(t);const e=await E(t);return this.loadedImages.set(t,e),e}parsePosition(t,e,r){return{x:S(t.x,e),y:S(t.y,r),width:S(t.width,e),height:S(t.height,r)}}resize(t,e){this.context.canvas&&(this.context.canvas.width=t,this.context.canvas.height=e,this.context.width=t,this.context.height=e)}clear(){if(!this.context.ctx)return;const{ctx:t,width:e,height:r}=this.context;t.clearRect(0,0,e,r)}getDataURL(t="image/png",e){if(!this.context.canvas)throw new Error("Canvas not available");return"image/jpeg"===t&&e?this.context.canvas.toDataURL(t,e):this.context.canvas.toDataURL(t)}destroy(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.loadedImages.clear()}}class O{constructor(t){this.loadedImages=new Map,this.context=t}async renderPage(t){if(!this.context.svg)throw new Error("SVG context not available");const{svg:e,width:r,height:i}=this.context;e.innerHTML="";try{if(t.background&&await this.renderBackground(t.background,r,i),t.images){const e=[...t.images].sort((t,e)=>(t.zIndex||0)-(e.zIndex||0));for(const t of e)await this.renderImage(t,r,i)}if(t.textBlocks){const e=[...t.textBlocks].sort((t,e)=>(t.zIndex||0)-(e.zIndex||0));for(const t of e)this.renderTextBlock(t,r,i)}t.animations&&this.applyAnimations(t.animations)}catch(t){throw console.error("Error rendering page:",t),t}}async renderBackground(t,e,r){if(!this.context.svg)return;const{svg:i}=this.context;if(t.color){const n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width",e.toString()),n.setAttribute("height",r.toString()),n.setAttribute("fill",t.color),i.appendChild(n)}if(t.gradient){const n=`gradient-${Math.random().toString(36).substr(2,9)}`,o=t.gradient.match(/linear-gradient\((\d+)deg,\s*([^,]+),\s*([^)]+)\)/);if(o){const[,t,s,a]=o,c=document.createElementNS("http://www.w3.org/2000/svg","defs"),l=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");l.setAttribute("id",n),l.setAttribute("x1","0%"),l.setAttribute("y1","0%"),l.setAttribute("x2","100%"),l.setAttribute("y2","100%"),l.setAttribute("gradientTransform",`rotate(${t})`);const h=document.createElementNS("http://www.w3.org/2000/svg","stop");h.setAttribute("offset","0%"),h.setAttribute("stop-color",s.trim());const d=document.createElementNS("http://www.w3.org/2000/svg","stop");d.setAttribute("offset","100%"),d.setAttribute("stop-color",a.trim()),l.appendChild(h),l.appendChild(d),c.appendChild(l),i.appendChild(c);const g=document.createElementNS("http://www.w3.org/2000/svg","rect");g.setAttribute("x","0"),g.setAttribute("y","0"),g.setAttribute("width",e.toString()),g.setAttribute("height",r.toString()),g.setAttribute("fill",`url(#${n})`),i.appendChild(g)}}if(t.image)try{const n=await this.loadImageAsDataURL(t.image),o=document.createElementNS("http://www.w3.org/2000/svg","image");o.setAttribute("x","0"),o.setAttribute("y","0"),o.setAttribute("width",e.toString()),o.setAttribute("height",r.toString()),o.setAttribute("href",n),o.setAttribute("preserveAspectRatio","xMidYMid slice"),i.appendChild(o)}catch(t){console.warn("Failed to load background image:",t)}}renderTextBlock(t,e,r){if(!this.context.svg)return;const{svg:i}=this.context,{x:n,y:o,width:s,height:a}=this.parsePosition(t.position,e,r),c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",n.toString()),c.setAttribute("y",(o+S(t.formatting.fontSize,16)).toString()),c.setAttribute("width",s.toString()),c.setAttribute("height",a.toString()),this.applyTextFormatting(c,t.formatting);const l=t.position.alignment||"left";"center"===l?(c.setAttribute("text-anchor","middle"),c.setAttribute("x",(n+s/2).toString())):"right"===l&&(c.setAttribute("text-anchor","end"),c.setAttribute("x",(n+s).toString()));const h=this.wrapText(t.content,t.formatting,s);if(1===h.length)c.textContent=A(h[0]),i.appendChild(c);else{const e=S(t.formatting.lineHeight||t.formatting.fontSize,16);for(let t=0;t<h.length;t++){const r=document.createElementNS("http://www.w3.org/2000/svg","tspan");r.setAttribute("x",c.getAttribute("x")||"0"),r.setAttribute("dy",0===t?"0":e.toString()),r.textContent=A(h[t]),c.appendChild(r)}i.appendChild(c)}if("underline"===t.formatting.textDecoration){const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1",n.toString()),e.setAttribute("y1",(o+a-2).toString()),e.setAttribute("x2",(n+s).toString()),e.setAttribute("y2",(o+a-2).toString()),e.setAttribute("stroke",t.formatting.color),e.setAttribute("stroke-width","1"),i.appendChild(e)}}async renderImage(t,e,r){if(!this.context.svg)return;const{svg:i}=this.context,{x:n,y:o,width:s,height:a}=this.parsePosition(t.position,e,r);try{const e=await this.loadImageAsDataURL(t.src),r=document.createElementNS("http://www.w3.org/2000/svg","image");if(r.setAttribute("x",n.toString()),r.setAttribute("y",o.toString()),r.setAttribute("width",s.toString()),r.setAttribute("height",a.toString()),r.setAttribute("href",e),r.setAttribute("preserveAspectRatio","xMidYMid meet"),t.altText&&r.setAttribute("alt",t.altText),t.filters&&t.filters.length>0){const e=`filter-${Math.random().toString(36).substr(2,9)}`;this.createFilter(e,t.filters),r.setAttribute("filter",`url(#${e})`)}i.appendChild(r),t.border&&this.drawBorder(n,o,s,a,t.border)}catch(e){console.warn("Failed to load image:",t.src,e);const r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x",n.toString()),r.setAttribute("y",o.toString()),r.setAttribute("width",s.toString()),r.setAttribute("height",a.toString()),r.setAttribute("fill","#f0f0f0"),r.setAttribute("stroke","#ccc"),r.setAttribute("stroke-width","1"),i.appendChild(r);const c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttribute("x",(n+s/2).toString()),c.setAttribute("y",(o+a/2).toString()),c.setAttribute("text-anchor","middle"),c.setAttribute("fill","#666"),c.setAttribute("font-family","Arial"),c.setAttribute("font-size","14"),c.textContent="Image not found",i.appendChild(c)}}applyAnimations(t){for(const e of t){const t=document.getElementById(e.target);t&&(t.style.transition=`all ${e.duration}ms ease`,t.style.opacity="0",setTimeout(()=>{t.style.opacity="1"},e.delay||0))}}async loadImageAsDataURL(t){if(this.loadedImages.has(t))return this.loadedImages.get(t);const e=await E(t),r=document.createElement("canvas"),i=r.getContext("2d");r.width=e.width,r.height=e.height,i.drawImage(e,0,0);const n=r.toDataURL("image/png");return this.loadedImages.set(t,n),n}parsePosition(t,e,r){return{x:S(t.x,e),y:S(t.y,r),width:S(t.width,e),height:S(t.height,r)}}applyTextFormatting(t,e){const r="number"==typeof e.fontSize?e.fontSize:S(e.fontSize,16);if(t.setAttribute("font-family",e.fontFamily),t.setAttribute("font-size",r.toString()),t.setAttribute("fill",e.color),e.fontStyle&&t.setAttribute("font-style",e.fontStyle),e.fontWeight&&t.setAttribute("font-weight",e.fontWeight.toString()),e.letterSpacing&&t.setAttribute("letter-spacing",e.letterSpacing.toString()),e.opacity&&t.setAttribute("opacity",e.opacity.toString()),e.shadow){const r=e.shadow.split(" ");if(r.length>=3){const e=`shadow-${Math.random().toString(36).substr(2,9)}`;this.createShadowFilter(e,r),t.setAttribute("filter",`url(#${e})`)}}}wrapText(t,e,r){const i=t.split(" "),n=[];let o="";for(const t of i){const i=o+(o?" ":"")+t,s="number"==typeof e.fontSize?e.fontSize:S(e.fontSize,16);i.length*s*.6>r&&o?(n.push(o),o=t):o=i}return o&&n.push(o),n}createFilter(t,e){if(!this.context.svg)return;let r=this.context.svg.querySelector("defs");r||(r=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.context.svg.appendChild(r));const i=document.createElementNS("http://www.w3.org/2000/svg","filter");i.setAttribute("id",t);for(const t of e)if(t.includes("blur")){const e=t.match(/blur\((\d+)px\)/);if(e){const t=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");t.setAttribute("stdDeviation",e[1]),i.appendChild(t)}}r.appendChild(i)}createShadowFilter(t,e){if(!this.context.svg)return;let r=this.context.svg.querySelector("defs");r||(r=document.createElementNS("http://www.w3.org/2000/svg","defs"),this.context.svg.appendChild(r));const i=document.createElementNS("http://www.w3.org/2000/svg","filter");i.setAttribute("id",t);const n=document.createElementNS("http://www.w3.org/2000/svg","feDropShadow");n.setAttribute("dx",e[0]||"0"),n.setAttribute("dy",e[1]||"0"),n.setAttribute("stdDeviation",e[3]||"0"),n.setAttribute("flood-color",e[2]||"#000"),i.appendChild(n),r.appendChild(i)}drawBorder(t,e,r,i,n){if(!this.context.svg)return;const{svg:o}=this.context,s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("x",t.toString()),s.setAttribute("y",e.toString()),s.setAttribute("width",r.toString()),s.setAttribute("height",i.toString()),s.setAttribute("fill","none"),s.setAttribute("stroke",n.color),s.setAttribute("stroke-width",n.width.toString()),"dashed"===n.style?s.setAttribute("stroke-dasharray","5,5"):"dotted"===n.style&&s.setAttribute("stroke-dasharray","2,2"),n.radius&&(s.setAttribute("rx",n.radius.toString()),s.setAttribute("ry",n.radius.toString())),o.appendChild(s)}resize(t,e){this.context.svg&&(this.context.svg.setAttribute("width",t.toString()),this.context.svg.setAttribute("height",e.toString()),this.context.svg.setAttribute("viewBox",`0 0 ${t} ${e}`),this.context.width=t,this.context.height=e)}getDataURL(){if(!this.context.svg)throw new Error("SVG not available");const t=(new XMLSerializer).serializeToString(this.context.svg);return`data:image/svg+xml,${encodeURIComponent(t)}`}clear(){this.context.svg&&(this.context.svg.innerHTML="")}destroy(){this.loadedImages.clear()}}var M=PageVisualizer;t.AssetLoadError=class extends r{constructor(t,e){super(t,"ASSET_LOAD_ERROR",e),this.name="AssetLoadError"}},t.CanvasRenderer=j,t.PageVisualizer=class{constructor(t){this.currentPage=null,this.isDestroyed=!1,this.options=z(t);const e={pageWidth:800,pageHeight:600,margin:{top:20,right:20,bottom:20,left:20},theme:"light",...this.options.globalStyles};this.context=this.createRenderingContext(e),this.renderer=this.createRenderer(),this.setupResizeHandling(),this.initializeContainer()}async renderPage(t){if(this.isDestroyed)throw new r("PageVisualizer has been destroyed","DESTROYED");try{const e=y(t);this.currentPage=e,this.updateContextForPage(e),await this.renderer.renderPage(e),this.options.onRender?.()}catch(t){const e=new n(`Failed to render page: ${t instanceof Error?t.message:"Unknown error"}`,t);throw this.options.onError?.(e),e}}async exportPage(t){if(this.isDestroyed)throw new r("PageVisualizer has been destroyed","DESTROYED");if(!this.currentPage)throw new r("No page to export","NO_PAGE");try{const e=v(t);if("canvas"===this.options.mode&&this.renderer instanceof j)return this.renderer.getDataURL(e.format,e.quality);if("svg"===this.options.mode&&this.renderer instanceof O)return this.renderer.getDataURL();throw new r("Export not supported for current rendering mode","UNSUPPORTED_EXPORT")}catch(t){const e=new r(`Failed to export page: ${t instanceof Error?t.message:"Unknown error"}`,"EXPORT_ERROR",t);throw this.options.onError?.(e),e}}resize(t,e){if(this.isDestroyed)throw new r("PageVisualizer has been destroyed","DESTROYED");this.context.width=t,this.context.height=e,this.context.scale=Math.min(t/this.options.globalStyles.pageWidth,e/this.options.globalStyles.pageHeight),this.renderer.resize(t,e),this.currentPage&&this.renderPage(this.currentPage).catch(t=>{this.options.onError?.(t)})}clear(){this.isDestroyed||(this.renderer.clear(),this.currentPage=null)}getCurrentPage(){return this.currentPage}getContext(){return{...this.context}}updateGlobalStyles(t){this.isDestroyed||(this.options.globalStyles={...this.options.globalStyles,...t},this.context.width=this.options.globalStyles.pageWidth,this.context.height=this.options.globalStyles.pageHeight,this.currentPage&&this.renderPage(this.currentPage).catch(t=>{this.options.onError?.(t)}))}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.renderer.destroy(),this.resizeObserver&&this.resizeObserver.disconnect(),this.options.container&&(this.options.container.innerHTML=""),this.currentPage=null,this.context=null,this.renderer=null)}createRenderingContext(t){const{pageWidth:e,pageHeight:i}=t,n={width:e,height:i,scale:1};switch(this.options.mode){case"canvas":const t=I(e,i),o=t.getContext("2d");if(!o)throw new r("Failed to get 2D context from canvas","CANVAS_ERROR");n.canvas=t,n.ctx=o;break;case"svg":const s=R(e,i);n.svg=s;break;case"dom":n.container=this.options.container;break;default:throw new r(`Unsupported rendering mode: ${this.options.mode}`,"UNSUPPORTED_MODE")}return n}createRenderer(){switch(this.options.mode){case"canvas":return new j(this.context);case"svg":return new O(this.context);case"dom":throw new r("DOM renderer not yet implemented","NOT_IMPLEMENTED");default:throw new r(`Unsupported rendering mode: ${this.options.mode}`,"UNSUPPORTED_MODE")}}initializeContainer(){const{container:t}=this.options;t.innerHTML="",this.context.canvas?t.appendChild(this.context.canvas):this.context.svg&&t.appendChild(this.context.svg),t.style.position="relative",t.style.overflow="hidden",this.options.onLoad?.()}updateContextForPage(t){}setupResizeHandling(){if("undefined"!=typeof ResizeObserver)this.resizeObserver=new ResizeObserver(D(t=>{for(const e of t){const{width:t,height:r}=e.contentRect;this.resize(t,r)}},100)),this.resizeObserver.observe(this.options.container);else{const t=D(()=>{const t=this.options.container.getBoundingClientRect();this.resize(t.width,t.height)},100);window.addEventListener("resize",t)}}},t.PageVisualizerError=r,t.RenderingError=n,t.SVGRenderer=O,t.ValidationError=i,t.animationSchema=u,t.applyImageFilters=k,t.applyTextFormatting=T,t.backgroundSchema=a,t.createCanvas=I,t.createSVG=R,t.customThemeSchema=m,t.debounce=D,t.deepClone=F,t.default=M,t.drawBorder=C,t.drawText=P,t.exportOptionsSchema=x,t.generateId=()=>Math.random().toString(36).substr(2,9),t.getTextMetrics=$,t.globalStylesSchema=f,t.imageElementSchema=d,t.interactiveElementSchema=p,t.isInViewport=t=>{const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},t.layoutOptionsSchema=g,t.loadImage=E,t.pageSchema=w,t.pageVisualizerOptionsSchema=b,t.parsePositionValue=S,t.positionSchema=s,t.positionToAbsolute=(t,e,r)=>({x:S(t.x,e),y:S(t.y,r),width:S(t.width,e),height:S(t.height,r)}),t.sanitizeHtml=A,t.textBlockSchema=h,t.throttle=(t,e)=>{let r;return(...i)=>{r||(t(...i),r=!0,setTimeout(()=>r=!1,e))}},t.validateAnimation=t=>{try{return u.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid animation data: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},t.validateBackground=t=>{try{return a.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid background data: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},t.validateCustomTheme=t=>{try{return m.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid custom theme: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},t.validateExportOptions=v,t.validateGlobalStyles=t=>{try{return f.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid global styles: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},t.validateImageElement=t=>{try{return d.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid image element data: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},t.validateInteractiveElement=t=>{try{return p.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid interactive element data: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},t.validateLayoutOptions=t=>{try{return g.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid layout options: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},t.validatePage=y,t.validatePageVisualizerOptions=z,t.validatePosition=t=>{try{return s.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid position data: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},t.validateTextBlock=t=>{try{return h.parse(t)}catch(t){if(t instanceof e.z.ZodError)throw new i(`Invalid text block data: ${t.errors.map(t=>t.message).join(", ")}`,t.errors);throw t}},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
